(function(e){e.fn.ajaxfileupload=function(t){var n={params:{},action:"",onStart:function(){},onComplete:function(e){},onCancel:function(){},validate_extensions:!0,valid_extensions:["gif","png","jpg","jpeg"],submit_button:null},r=!1;return t&&e.extend(n,t),this.each(function(){var t=e(this);if(t.data("ajaxUploader-setup")===!0)return;t.change(function(){r=!1,n.submit_button==null&&i()}),n.submit_button!=null&&n.submit_button.click(function(e){e.preventDefault(),r||i()});var i=function(){if(t.val()=="")return n.onCancel.apply(t,[n.params]);var i=t.val().split(".").pop().toLowerCase();if(!0===n.validate_extensions&&e.inArray(i,n.valid_extensions)==-1)n.onComplete.apply(t,[{status:!1,message:"The select file type is invalid. File must be "+n.valid_extensions.join(", ")+"."},n.params]);else{r=!0,o(t);var s=n.onStart.apply(t,[n.params]);s!==!1&&t.parent("form").submit(function(e){e.stopPropagation()}).submit()}};t.data("ajaxUploader-setup",!0);var s=function(e,t){var i,s=e.contentWindow.document.body.innerHTML;try{i=JSON.parse(s)}catch(o){i=s}t.siblings().remove(),t.unwrap(),r=!1,n.onComplete.apply(t,[i,n.params])},o=function(t){var r="ajaxUploader-iframe-"+Math.round((new Date).getTime()/1e3);e("body").after('<iframe width="0" height="0" style="display:none;" name="'+r+'" id="'+r+'"/>'),e("#"+r).load(function(){s(this,t)}),t.wrap(function(){return'<form action="'+n.action+'" method="POST" enctype="multipart/form-data" target="'+r+'" />'}).before(function(){var e,t="";for(e in n.params){var r=n.params[e];typeof r=="function"&&(r=r()),t+='<input type="hidden" name="'+e+'" value="'+r+'" />'}return t})}})}})(jQuery);