function afterUploadedImage(){}(function(e){e.fn.reditemCropImage=function(t){function n(e){return parseInt(e.css("padding-top").replace("px",""))+parseInt(e.css("margin-top").replace("px",""))}function r(e){return parseInt(e.css("padding-left").replace("px",""))+parseInt(e.css("margin-left").replace("px",""))}var i=e(this),s=getSize(i.attr("src")),o="#"+t.cropAreaId,u="#"+t.cropBtn,a=t.cropWidth,f=t.cropHeight,l=t.keepRatio,c=n(i),h=r(i),p=0,d=new Image;d.src=i.attr("src"),p=d.width/d.height,d=null;if(a==""&&f=="")a=i.width(),f=i.height();else if(a!=""&&f=="")a>i.width()&&(a=i.width()),f=a/p;else if(a==""&&f!="")f>i.height()&&(f=i.height()),a=f*p;else{var v=a/f;v>p?(a=i.width(),f=a/v):v<p&&(f=i.height(),a=f*v)}if(i.length){e(o).parent().remove();var m=c,g=h,y=i.width(),b=i.height(),w=(e(i).outerHeight()-e(i).innerHeight())/2,E=(e(i).outerWidth()-e(i).innerWidth())/2;isNaN(w)||(m+=w,b+=w),isNaN(E)||(g+=E,y+=E);var S=e("<div>").css({position:"absolute","z-index":99,width:y+"px",height:b+"px",top:m+"px",left:g+"px",overflow:"hidden"});e("<div>").attr("id",t.cropAreaId).css({position:"absolute","z-index":99,width:a+"px",height:f+"px",top:"0px",left:"0px","box-shadow":"0 0 0 1000px rgba(0, 0, 0, 0.65)","box-sizing":"border-box",overflow:"hidden"}).appendTo(S),i.parent().append(S),l==1?(e(o).resizable({containment:i,handles:"all",aspectRatio:a/f}).draggable({containment:i}),d=null):e(o).resizable({containment:i,handles:"all"}).draggable({containment:i}),afterUploadedImage()}e(u).click(function(t){t.preventDefault();var n=i.attr("src").split("/");return n.length&&(n=n[n.length-1]),n=n.split("?"),n.length&&(n=n[0]),e.ajax({type:"POST",url:"index.php?option=com_reditem&task=item.ajaxCropImage",data:{image_name:n,top:e(o).position().top,left:e(o).position().left,width:e(o).width(),height:e(o).height(),previewWidth:i.width(),previewHeight:i.height()},success:function(t){e(i).addClass("img-cropped"),t=="1"?i.attr("src",i.attr("src")+"?"+Math.random()).hide().fadeIn("fast"):alert(Joomla.JText._("COM_REDITEM_FEATURE_CROPIMAGE_FAIL"))}}),!1})}})(jQuery);